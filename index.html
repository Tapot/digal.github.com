
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Лошоть и байты</title>
  <meta name="author" content="Yuri Buyanov">

  
  <meta name="description" content="Итак, обещанные ссылки. Сразу предупреждаю, что практически всё - не такое уж и новое, но тем кто не видел — определённо стоит посмотреть. ">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://digal.github.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Лошоть и байты" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25244055-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Лошоть и байты</a></h1>
  
    <h2>The blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:digal.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Блог</a></li>
  <li><a href="/blog/archives">Архив</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/03/links/">Links</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-03T12:43:00+04:00" pubdate data-updated="true">May 3<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Итак, обещанные ссылки. Сразу предупреждаю, что практически всё - не такое уж и новое, но тем кто не видел — определённо стоит посмотреть.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/05/03/links/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/03/update/">Апдейт</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-03T12:08:00+04:00" pubdate data-updated="true">May 3<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>И снова здравствуйте.</p>

<p>Поскольку времени на написание развёрнутых постов &#8220;на тему&#8221; категорически не хватает, мне пришла в голову мысль решить одним махом сразу две проблемы: оживить бложек и начать складывать куда-то все ссылки, которые лежат мёртвым грузом в &#8220;избранном&#8221; твиттера, инстапапере, гуглоридере и даже в закладках браузера. То есть, попросту говоря, организовать небольшой линкоблог по типу Бобуковского <a href="http://addmeto.cc/">addmeto.cc</a>, на который если кто-то ещё не подписался, то очень зря. Сегодня вечером попробую выложить то что собралось за вчера/сегодня отдельным постом, ну и дальше буду выкладывать по мере накопления.</p>

<p>На самом деле, тем на один-два поста у меня уже накопилось, в частности про то, как у нас выстроился процесс разработки в мобильном отделе (да, я всё ещё пишу под айфончики), на какие грабли было наступлено и какие вещи ещё только планируется сделать.</p>

<p>Также, не могу не упомянуть про одну из причин нехватки времени: отличные онлайн-курсы от <a href="https://www.coursera.org/">Coursera</a>. Вот буквально неделю назад я сдал финальный экзамен по <a href="https://www.coursera.org/course/algo">Design and Analysis of Algorithms I</a> от Стэнфорда, не удержался и начал десятинедельный <a href="https://www.coursera.org/course/compilers">Compilers</a> от него же, хотя пока не уверен, что буду успевать всё делать.</p>

<p>Ну и на последок, прорекламирую очередной <a href="http://elegion.timepad.ru/event/manage/21310">ScalaSPB</a>, который пройдёт 19 Мая. Приходите, пообщаемся.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/04/2011-2012/">2011/2012</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-04T22:33:00+04:00" pubdate data-updated="true">Jan 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Наконец дозрел до стандартного поста в виде небольшого подбивания (профессиональных) итогов года и построения планов на следующий. Год назад я приблизительно сформулировал в голове вещи, которые мне бы хотелось сделать в 2011-м, и, оглядываясь назад, можно с хорошей долей уверенности сказать что бОльшая часть вещей так или иначе выполнена.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/01/04/2011-2012/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/30/ios-impressions-2/">iOS-dev: первые впечатления. Всё остальное.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-30T17:44:00+04:00" pubdate data-updated="true">Nov 30<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Итак, продолжаю описывать уже немного утрясшиеся впечатления от iOS-разработки. Если кто-то пропустил, то <a href="http://digal.github.com/blog/2011/11/22/ios-impressions/">вот первый пост</a>. Теперь немного расскажу об инструментах и экостистеме. Сразу оговорюсь, что поскольку &#8220;настоящим сварщиком&#8221; мне называться пока рано, я могу быть не в курсе источников и реальных причин каких-то недочётов. Например, я наверняка буду приписывать отдельным инструментам недостатки, происходящие от других элементов тулчейна или даже просто из сложившихся здесь традиций.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/11/30/ios-impressions-2/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/22/ios-impressions/">iOS-dev: первые впечатления. Язык.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-22T10:22:00+04:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Недели три назад мне пришлось основательно взяться за разработку под iOS и (куда же тут без него) Objective-C. Из всего опыта была только прочитанная летом наполовину <a href="http://oreilly.com/catalog/9781449397296">книжка</a> по сабжу, пару раз открытый XCode, и попытка собрать <a href="http://www.scummvm.org/">ScummVM</a> для iPad из сорцов. Надо сказать что идея овладеть obj-c появилась у меня в голове ещё больше года назад (с появлением iPad), а после переезда на мак этому не оставалось уже никаких препятствий.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/11/22/ios-impressions/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/03/squeryl-advanced/">Squeryl: Двигаемся дальше</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-03T22:38:00+04:00" pubdate data-updated="true">Oct 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Итак, продолжаем наше знакомство со <a href="http://squeryl.org/">Sueryl</a> (начало <a href="https://digal.github.com/blog/2011/09/25/squeryl/">тут</a>). Для начала, вернёмся к селектам и рассмотрим одну из интереснейших фич Squeryl.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/10/03/squeryl-advanced/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/25/squeryl/">Squeryl: основы</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-25T21:46:00+04:00" pubdate data-updated="true">Sep 25<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Этим и следующим постом (который, надеюсь, будет вот совсем скоро) я хочу познакомить вас с замечательной ORM-библиотекой для scala, которую сейчас использую в одном из рабочих проектов. Не надо пугаться аббревиатуры ORM: возожности маппинга к объектам здесь принципиально реализованы на совсем базовом уровне, а вот симпатичный DSL для запросов стоит того, чтобы на него взглянуть.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/09/25/squeryl/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/07/fixtures/">Fixtures</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-07T09:46:00+04:00" pubdate data-updated="true">Sep 7<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>В предыдущем посте я рассказывал об исполняемых конфигах ostrich и не упомянул особых их достоинств, кроме type safety и удобства работы с настройками со стороны приложения. На прошлой неделе я наткнулся на ещё один хороший юзкейс для таких конфигов.</p>

<p>Предположим, мы развёртываем наше приложение в разных окружениях (dev, test, prod), и в некоторых из них было бы здорово иметь в базе некоторые начальные данные для упрощения, например, процесса тестирования. Есть несколько достаточно тривиальных, но не очень удобных способов решения этой проблемы, особенно если загрузка этих начальных данных - часть автоматического развёртывания через CI-сервер. В скриптовых языках, где исполняемые файлы настроек - норма, такие данные (называемые fixtures) часто делаются частью конфига.</p>

<p>С ostrich реализация такой штуки становится делом буквально нескольких строк кода:</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/09/07/fixtures/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/05/no-newsletters/">Пример хорошего UX</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-05T12:15:00+04:00" pubdate data-updated="true">Sep 5<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Регистрируясь на <a href="http://coderwall.com/">coderwall</a> (по наводке <a href="http://twitter.com/shaman_sir">@shaman_sir</a>) увидел замечательный пример той самой области UX, не относящейся ни к дизайну ни к юзабилити. Ничего супер-пупер-грандиозного, просто под полем для ввода электропочты в форме регистрации - небольшое примечание.</p>

<blockquote><p>No spam, always private. We respect the sanctity of your email and share your dislike for spam and unnecessarily frequent newsletters. If you&#8217;re interested in future coderwall news, we suggest you follow us on twitter.</p></blockquote>


<p>Не знаю как вам, а мне безумно приятно видеть сервис, уважающий моё личное информационное пространство и максимально ненавязчиво предлагающий просто подписаться на твиттер, если уж мне так хочется читать относящиеся к нему новости. По-моему, это гораздо лучше обычной галочки &#8220;присылать/не присылать новости&#8221;: в случае с твиттером заранее знаешь, что отписаться при желании можно будет в любой момент и одной кнопкой. Я уже не говорю о случаях, когда пользователю вообще не оставляют никакого выбора.</p>

<p>В общем, я кажется нашёл главный секрет хорошего UX: &#8220;Уважай своего пользователя&#8221;. Просто ведь, правда?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/29/scala-irl-2-ostrich/">Scala IRL. Часть 2: Готовим Домашнего Страуса</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-29T22:28:00+04:00" pubdate data-updated="true">Aug 29<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>В предыдущем посте я мельком упомянул библиотеку ostrich в качестве инструмента для загрузки конфигов, в этом же постараюсь сделать более подробный обзор. Итак, <a href="github.com/twitter/ostrich">ostrich</a> - это внутренняя библиотека от разработчиков &#8220;твиттера&#8221;, используемая в его компонентах. Несмотря на фичастость и навороченность, местами довольно-таки заметен её стиль, как библиотеки написанной в первую очередь &#8220;для себя&#8221;.</p>

<p>Оstrich выполняет следующие задачи:</p>

<ul>
<li>загрузка и парсинг typesafe-конфигов (проще, говоря, конфигов в виде scala-кода)</li>
<li>сбор рантайм-статистики и разнообразных метрик</li>
<li>управление сервисами внутри процесса (запуск/остановка)</li>
<li>предоставление простенького, но расширяемого администраторского интерфейса через http/socket</li>
</ul>


<p>В этом посте я опишу работу с конфигами, а остальные возможности попробую раскрыть в последующих постах.</p>

<h2>Страус и конфиги</h2>

<p>Итак, ostrich предлагает использовать в качестве конфигов не просто структурированные текстовые файлы (json/xml/properties), а scala-код. Такой подход требует компиляции конфига при загрузке, но имеет ряд серьёзных преимуществ:</p>

<ul>
<li>типизация. Отпадает необходимость проверять и приводить значения из конфиг-файла к нужным типам</li>
<li>возможность писать произвольный код в конфигах, помимо простых значений. Например, использовать текущую дату в произвольном формате в имени лог-файла, или получить значения каких-то параметров из базы или стороннего сервиса. По сути, конфиг-файл становится тем, что называется extension point.</li>
<li>становятся ненужными отдельные классы, инкапсулирующие конфигурацию различных компонентов программы, или, по крайней мере, упрощается их создание.</li>
</ul>


<p>Для начала, нам нужно создать родительский класс для настроек. Чаще всего удобно сделать его же конфигом по умолчанию. Предположим, мы хотим сконфигурировать небольшое серверное приложение. Для этого ostrich предоставляет класс ServerConfig (являющийся наследником Config, предоставляющего базовые функции такие как компиляция, валидация и обязательные/необязательные поля).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">com.twitter.ostrich.admin._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.ostrich.admin.config._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.logging.config._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.logging.Level</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MyServerConfig</span> <span class="k">extends</span> <span class="nc">ServerConfig</span><span class="o">[</span><span class="kt">MyServer</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//ServerConfig, в отличие от просто Config, должен определить </span>
</span><span class='line'>  <span class="c1">//метод Apply, для создания инстанса сервера</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">runtime</span><span class="k">:</span> <span class="kt">RuntimeEnvironment</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">new</span> <span class="nc">MyServer</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">var</span> <span class="n">port</span> <span class="k">=</span> <span class="mi">1234</span>
</span><span class='line'>  <span class="k">var</span> <span class="n">workersNum</span> <span class="k">=</span> <span class="mi">10</span>
</span><span class='line'>  <span class="k">var</span> <span class="n">baseUrl</span> <span class="k">=</span> <span class="s">&quot;http://localhost:%s&quot;</span> <span class="n">format</span> <span class="n">port</span>
</span><span class='line'>  <span class="k">var</span> <span class="n">dbConfig</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DBConfig</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">DBConfig</span><span class="o">(</span>
</span><span class='line'>  <span class="k">var</span> <span class="n">driver</span> <span class="k">=</span> <span class="s">&quot;org.h2.Driver&quot;</span>
</span><span class='line'>  <span class="k">var</span> <span class="n">uri</span> <span class="k">=</span> <span class="s">&quot;jdbc:h2:mem:&quot;</span>
</span><span class='line'>  <span class="k">var</span> <span class="n">create</span> <span class="k">=</span> <span class="kc">true</span>
</span><span class='line'><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Надо заметить, что мы используем в этом конфиге изменяемые переменные (<code>var</code>). В Scala это зачастую является признаком недостаточно функционального (декларативного) стиля, однако в данном случае это позволит писать лаконичные конфиги, выставляя значение полей простым присваиванием. Кроме того, этот же стиль используется при объявлении уже имеющихся в ServerConfig значений.</p>

<p>Итак, теперь наш конфиг для, например, тестового сервера, может выглядеть так:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="k">new</span> <span class="nc">MyServerConfig</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">port</span> <span class="k">=</span> <span class="mi">80</span>
</span><span class='line'>      <span class="n">baseUrl</span> <span class="k">=</span> <span class="s">&quot;http://test.myserver.com&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">dbConfig</span><span class="o">.</span><span class="n">uri</span> <span class="k">=</span> <span class="s">&quot;jdbc:h2:/tmp/test.db;AUTO_SERVER=TRUE&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Вполне лаконично, и ничуть не хуже .properties и уж тем более XML-файла. Можем сохранить его под именем <code>test.scala</code>, тогда наш сервер мы сможем запускать как</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>    java -jar my-server.jar -f ./test.scala
</span></code></pre></td></tr></table></div></figure>


<h2>Загрузка</h2>

<p>Теперь, наш файл настроек надо загрузить и использовать по назначению. Делать это логичнее всего поближе к точке входа, например в <code>main</code>. Путь к файлу можно передать с параметром <code>-f</code> при запуске приложения, а если его нет, то ostrich попытается найти его сам. Определение местоположения конфиг-файла - это то самое место, где становится видно, что проект делался для себя: ostrich ищет его в довольно специфических местах, пытаясь сначала выяснить имя jar-файла. Поэтому, проще всего всегда передавать путь к конфигу через <code>-f</code> плюс явно указать конфиг по умолчанию. Поскольку конфиг по умолчанию является обычным scala-классом, можно просто создать его инстанс в коде. Вот как выглядит загрузка и использование конфига у меня:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="k">object</span> <span class="nc">MyServer</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">runtime</span> <span class="k">=</span> <span class="nc">RuntimeEnvironment</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">args</span><span class="o">)</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">server</span> <span class="k">=</span>
</span><span class='line'>          <span class="k">if</span> <span class="o">(</span><span class="n">runtime</span><span class="o">.</span><span class="n">configFile</span><span class="o">.</span><span class="n">exists</span><span class="o">)</span> <span class="c1">//если ostrich нашёл конфиг-файл </span>
</span><span class='line'>            <span class="n">runtime</span><span class="o">.</span><span class="n">loadRuntimeConfig</span><span class="o">[</span><span class="kt">Server</span><span class="o">]()</span>
</span><span class='line'>          <span class="k">else</span> <span class="c1">//default</span>
</span><span class='line'>            <span class="o">(</span><span class="k">new</span> <span class="nc">MyServerConfig</span><span class="o">)()(</span><span class="n">runtime</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="o">()</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">MyServer</span><span class="o">(</span><span class="k">val</span> <span class="n">config</span><span class="k">:</span> <span class="kt">MyServerConfig</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">db</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DB</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">dbConfig</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="n">start</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">//...</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Обратите внимание на строчку <code>(new MyServerConfig)()(runtime)</code>: сначала мы вызываем метод apply без параметров, а потом вызываем полученную функцию с параметром типа RuntimeEnvironment. При необходимости, этот способ можно расширить для загрузки различных конфигов по умолчанию, например в зависимости от <code>run.mode</code> в lift.</p>

<p>Я не использовал возможность ostrich объявлять поля как обязательные/опциональные, но промолчать о ней будет, наверное, неправильно. В приведённой к классу Config документации всё довольно просто:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="c1">//необязательное поле</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">something</span> <span class="k">=</span> <span class="n">optional</span><span class="o">[</span><span class="kt">Duration</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//обязательное поле</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">level</span> <span class="k">=</span> <span class="n">required</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//вычисляемое (lazily evaluated!) поле</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">nextLevel</span> <span class="k">=</span> <span class="n">computed</span><span class="o">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Конфигурация компонентов</h2>

<p>В вышеприведённом примере мы вынесли настройку базы данных в отдельный класс DBConfig. Иногда, со стороны приложения бывает удобно вынести конфигурацию в отдельный класс, но усложнять структуру конфиг-файла не хочется. Хорошим примером является случай, когда конфигурируемый компонент находится в другом (под)проекте. В этом случае, конфиг можно объявить трейтом и подмешать его в основной конфиг</p>

<p>Представим, что мы хотим добавить в наш север небольшой внутренний почтовый сервис для отсылки писем пользователям.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">trait</span> <span class="nc">MailConfig</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">smtpServer</span><span class="k">:</span>  <span class="kt">String</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">smtpPort</span><span class="k">:</span>    <span class="kt">String</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">fromAddress</span><span class="k">:</span> <span class="kt">String</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MailManager</span><span class="o">(</span><span class="k">val</span> <span class="n">config</span><span class="k">:</span> <span class="kt">MailConfig</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Теперь мы просто подмешиваем трейт в наш основной конфиг, перегружая его методы нашими <code>var</code>ами:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="k">class</span> <span class="nc">MyServerConfig</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">ServerConfig</span><span class="o">[</span><span class="kt">MyServer</span><span class="o">]</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">MailConfig</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">var</span> <span class="n">smtpServer</span> <span class="k">=</span> <span class="n">required</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</span><span class='line'>      <span class="k">var</span> <span class="n">smtpPort</span> <span class="k">=</span> <span class="mi">24</span>
</span><span class='line'>      <span class="k">var</span> <span class="n">fromAddress</span> <span class="k">=</span> <span class="s">&quot;noreply@domain.com&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>В нашем конфиг-файле (<code>test.scala</code>) эти поля будут работать точно так же как и все остальные. При инстанциировании менеджера можно просто передать ему общий конфиг:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="k">class</span> <span class="nc">MyServer</span><span class="o">(</span><span class="k">val</span> <span class="n">config</span><span class="k">:</span> <span class="kt">MyServerConfig</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">db</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DB</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">dbConfig</span><span class="o">)</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">mailer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MailManager</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">...</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Также, в отдельный трейт можно вынести готовые значения для настроек если они представляют собой что-то более сложное чем простые значения.</p>

<p>Вот собственно и всё что я хотел рассказать об использовании ostrich для конфигурирования. Я намеренно не стал рассматривать имеющиеся в ServerConfig поля для настройки логгинга, статистики и админки. Мы вернёмся к ним попозже, когда я буду рассказывать о соответствующих фичах &#8220;страуса&#8221;.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Ссылки:</h1>
  <ul>
    <li><a href="http://www.e-legion.ru/">Работа</a></li>
    <li><a href="https://github.com/digal/">GitHub</a></li>
    <li><a href="http://twitter.com/#!/digal">Twitter</a></li>
  </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/05/03/links/">Links</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/03/update/">Апдейт</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/04/2011-2012/">2011/2012</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/30/ios-impressions-2/">iOS-dev: первые впечатления. Всё остальное.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/22/ios-impressions/">iOS-dev: первые впечатления. Язык.</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/digal">@digal</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'digal',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("digal", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/digal" class="twitter-follow-button" data-show-count="false">Follow @digal</a>
  
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Yuri Buyanov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'digal';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
